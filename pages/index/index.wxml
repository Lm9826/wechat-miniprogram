<!--index.wxml-->
<view class="page-container">
  <!-- èƒŒæ™¯å›¾ç‰‡ -->
  <image class="background-image" src="/images/background.jpg" mode="aspectFill"></image>
  
  <scroll-view class="scroll-container" scroll-y="true" enable-flex="true">
  <view class="container">
  <!-- è‡ªå®šä¹‰è¿”å›æŒ‰é’® -->
  <view class="custom-nav">
    <view class="back-button" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
  </view>
  
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header">
    <text class="title">æ‹çˆ±æ—¥è®°</text>
    
    <!-- ç”¨æˆ·å¤´åƒåŒºåŸŸ -->
    <view class="avatars-section">
      <!-- ç”¨æˆ·1å¤´åƒ - ä½¿ç”¨æ–°çš„å¾®ä¿¡å¤´åƒé€‰æ‹© -->
      <view class="avatar-container">
        <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseUser1Avatar">
          <image class="avatar" src="{{userAvatars[0]}}" mode="aspectFill"></image>
        </button>
        <view class="avatar-edit">é€‰æ‹©å¤´åƒ</view>
      </view>
      
      <view class="plus-icon">+</view>
      
      <!-- ç”¨æˆ·2å¤´åƒ - æ‰‹åŠ¨é€‰æ‹© -->
      <view class="avatar-container">
        <image class="avatar" src="{{userAvatars[1]}}" mode="aspectFill" bindtap="chooseUser2Avatar"></image>
        <view class="avatar-edit">é€‰æ‹©å¤´åƒ</view>
      </view>
    </view>

    <!-- æ˜µç§°è¾“å…¥åŒºåŸŸ -->
    <view class="nicknames-section">
      <input type="nickname" class="nickname-input" placeholder="å¾®ä¿¡ç”¨æˆ·" 
             value="{{userInfo1.nickName}}" bind:change="onUser1NickNameChange" />
      <input type="nickname" class="nickname-input" placeholder="TA" 
             value="{{userInfo2.nickName}}" bind:change="onUser2NickNameChange" />
    </view>

    <!-- è¯´æ˜æ–‡å­— -->
    <view class="tips-section">
      <text class="tips-text">ğŸ’¡ ç‚¹å‡»å¤´åƒé€‰æ‹©ç…§ç‰‡ï¼Œè¾“å…¥æ¡†å¯å¡«å†™æ˜µç§°</text>
    </view>

    <!-- æ¯æ—¥æ¨é€è®¢é˜… -->
    <view class="push-subscribe-section">
      <view class="subscribe-card">
        <view class="subscribe-content">
          <text class="subscribe-title">æ¯æ—¥æ—©å®‰æ¨é€</text>
          <text class="subscribe-desc">ä½¿ç”¨Serveré…±æ¨é€æ¯æ—¥æé†’</text>
        </view>
        <button class="subscribe-btn {{dailyPushSubscribed ? 'subscribed' : ''}}" 
                bindtap="{{dailyPushSubscribed ? 'unsubscribeDailyPush' : 'showSendKeyInput'}}">
          {{dailyPushSubscribed ? 'å·²è®¢é˜…' : 'è®¾ç½®'}}
        </button>
      </view>
      
      <!-- SendKeyè¾“å…¥å¼¹çª— -->
      <view class="sendkey-modal" wx:if="{{showSendKeyInput}}">
        <view class="modal-content">
          <view class="modal-header">
            <text class="modal-title">è®¾ç½®æ¨é€</text>
            <text class="modal-close" bindtap="hideSendKeyInput">Ã—</text>
          </view>
          <view class="modal-body">
            <text class="input-label">è¯·è¾“å…¥Serveré…±SendKeyï¼š</text>
            <input class="sendkey-input" 
                   placeholder="è¯·è¾“å…¥æ‚¨çš„SendKey" 
                   value="{{sendKey}}"
                   bindinput="onSendKeyInput" />
            <text class="input-tip">è¯·å‰å¾€ https://sct.ftqq.com æ³¨å†Œè·å–SendKey</text>
          </view>
          <view class="modal-footer">
            <button class="modal-btn cancel" bindtap="hideSendKeyInput">å–æ¶ˆ</button>
            <button class="modal-btn confirm" bindtap="saveSendKey">ä¿å­˜</button>
          </view>
        </view>
      </view>
      
            <!-- ä½ç½®å’Œå¤©æ°”ä¿¡æ¯æ˜¾ç¤º -->
      <view class="location-section" wx:if="{{dailyPushSubscribed}}">
        <view class="location-card">
          <view class="location-content">
            <text class="location-title">å½“å‰ä½ç½®</text>
            <text class="location-info">{{userLocation.city}}</text>
            <text class="location-detail" wx:if="{{userLocation.district}}">{{userLocation.district}}, {{userLocation.province}}</text>
          </view>
          <view class="location-buttons">
            <button class="location-btn" bindtap="refreshLocation" disabled="{{locationLoading}}">
              {{locationLoading ? 'è·å–ä¸­...' : 'åˆ·æ–°ä½ç½®'}}
            </button>
            <button class="location-btn select-city-btn" bindtap="selectCity">
              é€‰æ‹©åŸå¸‚
            </button>
          </view>
        </view>
      </view>

      <!-- å¤©æ°”ä¿¡æ¯æ˜¾ç¤º -->
      <view class="weather-section" wx:if="{{dailyPushSubscribed}}">
        <view class="weather-card">
          <view class="weather-header">
            <text class="weather-title">ä»Šæ—¥å¤©æ°”</text>
            <button class="weather-refresh-btn" bindtap="refreshWeather" disabled="{{weatherLoading}}">
              {{weatherLoading ? 'è·å–ä¸­...' : 'åˆ·æ–°'}}
            </button>
          </view>
          <view class="weather-content" wx:if="{{weatherInfo.temperature}}">
            <view class="weather-main">
              <text class="weather-icon">{{weatherInfo.icon}}</text>
              <view class="weather-temp-info">
                <text class="weather-temp">{{weatherInfo.temperature}}Â°C</text>
                <text class="weather-condition">{{weatherInfo.condition}}</text>
              </view>
            </view>
            <view class="weather-details">
              <view class="weather-detail-item">
                <text class="detail-label">æ¹¿åº¦</text>
                <text class="detail-value">{{weatherInfo.humidity}}%</text>
              </view>
              <view class="weather-detail-item">
                <text class="detail-label">é£é€Ÿ</text>
                <text class="detail-value">{{weatherInfo.windSpeed}}km/h</text>
              </view>
              <view class="weather-detail-item">
                <text class="detail-label">é£å‘</text>
                <text class="detail-value">{{weatherInfo.windDir}}</text>
              </view>
            </view>
            <view class="weather-details" wx:if="{{weatherInfo.feelsLike || weatherInfo.pressure || weatherInfo.visibility}}">
              <view class="weather-detail-item" wx:if="{{weatherInfo.feelsLike}}">
                <text class="detail-label">ä½“æ„Ÿæ¸©åº¦</text>
                <text class="detail-value">{{weatherInfo.feelsLike}}Â°C</text>
              </view>
              <view class="weather-detail-item" wx:if="{{weatherInfo.pressure}}">
                <text class="detail-label">æ°”å‹</text>
                <text class="detail-value">{{weatherInfo.pressure}}hPa</text>
              </view>
              <view class="weather-detail-item" wx:if="{{weatherInfo.visibility}}">
                <text class="detail-label">èƒ½è§åº¦</text>
                <text class="detail-value">{{weatherInfo.visibility}}km</text>
              </view>
            </view>
          </view>
          <view class="weather-loading" wx:else>
            <text class="loading-text">{{weatherLoading ? 'è·å–å¤©æ°”ä¸­...' : 'æš‚æ— å¤©æ°”ä¿¡æ¯'}}</text>
          </view>
        </view>
      </view>


    </view>
    
    <!-- æ‹çˆ±å¤©æ•° -->
    <view class="love-days">
      <text class="days-text">åœ¨ä¸€èµ·å·²ç»</text> 
      <text class="days-number">{{loveDays}}</text>
      <text class="days-unit">å¤©</text>
    </view>
  </view>

  <!-- åŠŸèƒ½å¡ç‰‡åŒºåŸŸ -->
  <view class="features-section">
    <!-- å·¦ä¾§å¤§å¡ç‰‡ -->
    <view class="feature-large" 
          bindtap="onFeatureClick" 
          data-id="{{features[0].id}}"
          style="background: {{features[0].bgColor}}">
      <view class="feature-icon">{{features[0].icon}}</view>
      <view class="feature-content">
        <text class="feature-title">{{features[0].title}}</text>
        <text class="feature-subtitle">{{features[0].subtitle}}</text>
      </view>
    </view>
    
    <!-- å³ä¾§å¡ç‰‡ç»„ -->
    <view class="features-right">
      <view class="feature-small" 
            wx:for="{{features}}" 
            wx:for-index="idx"
            wx:key="id" 
            wx:if="{{idx > 0 && idx < 3}}"
            bindtap="onFeatureClick" 
            data-id="{{item.id}}"
            style="background: {{item.bgColor}}">
        <view class="small-title">{{item.title}}</view>
        <view class="small-subtitle">{{item.subtitle}}</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å¡ç‰‡è¡Œ -->
  <view class="features-bottom">
    <view class="feature-bottom" 
          wx:for="{{features}}" 
          wx:for-index="idx"
          wx:key="id" 
          wx:if="{{idx >= 3}}"
          bindtap="onFeatureClick" 
          data-id="{{item.id}}"
          style="background: {{item.bgColor}}">
      <view class="bottom-title">{{item.title}}</view>
      <view class="bottom-subtitle">{{item.subtitle}}</view>
    </view>
  </view>
</view>
</scroll-view>
</view>

